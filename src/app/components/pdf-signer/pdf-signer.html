<div class="pdf-signer-container">
  <div class="header">
    <h1>ğŸ” Semnare ElectronicÄƒ PDF</h1>
    <div class="service-status" [ngClass]="serviceStatus">
      <span class="status-indicator"></span>
      <span *ngIf="serviceStatus === 'online'">Serviciu online</span>
      <span *ngIf="serviceStatus === 'offline'">Serviciu offline</span>
      <span *ngIf="serviceStatus === 'unknown'">Verificare...</span>
      <button 
        class="btn-recheck" 
        (click)="recheckStatus()"
        [disabled]="serviceStatus === 'unknown'"
        title="VerificÄƒ din nou statusul"
        type="button"
      >
        <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
          <path d="M11.534 7h3.932a.25.25 0 0 1 .192.41l-1.966 2.36a.25.25 0 0 1-.384 0l-1.966-2.36a.25.25 0 0 1 .192-.41zm-11 2h3.932a.25.25 0 0 0 .192-.41L2.692 6.23a.25.25 0 0 0-.384 0L.342 8.59A.25.25 0 0 0 .534 9z"/>
          <path fill-rule="evenodd" d="M8 3c-1.552 0-2.94.707-3.857 1.818a.5.5 0 1 1-.771-.636A6.002 6.002 0 0 1 13.917 7H12.9A5.002 5.002 0 0 0 8 3zM3.1 9a5.002 5.002 0 0 0 8.757 2.182.5.5 0 1 1 .771.636A6.002 6.002 0 0 1 2.083 9H3.1z"/>
        </svg>
      </button>
    </div>
  </div>

  <!-- InstrucÈ›iuni repornire serviciu -->
  <div *ngIf="showInstructions" class="instructions-panel card">
    <div class="instructions-header">
      <h3>âš ï¸ Serviciul de Semnare Nu Este Disponibil</h3>
      <button class="btn-close" (click)="closeInstructions()">âœ•</button>
    </div>
    
    <div class="instructions-content">
      <p><strong>Pentru a porni serviciul de semnare:</strong></p>
      
      <ol>
        <li>
          <strong>VerificÄƒ dacÄƒ ruleazÄƒ:</strong>
          <ul>
            <li>Deschide <strong>Task Manager</strong> (Ctrl + Shift + Esc)</li>
            <li>CautÄƒ procesul <code>SignToolDaemon.exe</code></li>
          </ul>
        </li>
        
        <li>
          <strong>DacÄƒ nu ruleazÄƒ, porneÈ™te-l:</strong>
          <ul>
            <li>NavigheazÄƒ la: <code>C:\Program Files\SignTool\</code></li>
            <li>RuleazÄƒ: <code>SignToolDaemon.exe</code></li>
          </ul>
        </li>
        
        <li>
          <strong>SAU foloseÈ™te Command Prompt:</strong>
          <div class="code-block">
            <code>cd C:\zzz\Ionut\SignToolDaemon\SignToolDaemon</code><br>
            <code>dotnet run</code>
          </div>
        </li>
        
        <li>
          <strong>VerificÄƒ cÄƒ serviciul ascultÄƒ pe portul corect:</strong>
          <div class="code-block">
            <code>netstat -ano | findstr :5000</code>
          </div>
        </li>
      </ol>

      <div class="help-note">
        <strong>ğŸ’¡ NotÄƒ:</strong> Serviciul trebuie sÄƒ ruleze <strong>local pe calculatorul tÄƒu</strong> 
        pentru a avea acces la token-ul USB de semnare.
      </div>

      <button class="btn-primary" (click)="recheckStatus()">
        ğŸ”„ VerificÄƒ Din Nou
      </button>
    </div>
  </div>

  <div class="upload-section card">
    <h2>ğŸ“„ Document È™i SemnÄƒturÄƒ</h2>
    
    <!-- 1. PDF Upload -->
    <div class="form-group">
      <label for="pdfFile">Document PDF (obligatoriu):</label>
      <div class="file-input-wrapper">
        <input 
          type="file" 
          id="pdfFile"
          (change)="onFileSelected($event)" 
          accept=".pdf"
          [disabled]="isLoading"
        />
        <label for="pdfFile" class="file-label">
          <span class="icon">ğŸ“</span>
          <span *ngIf="!fileName">Alege fiÈ™ier PDF</span>
          <span *ngIf="fileName">{{ fileName }}</span>
        </label>
      </div>
    </div>

    <!-- 2. Signature Image Upload (NEW) -->
    <div class="form-group">
      <label for="signatureImage">Imagine SemnÄƒturÄƒ JPG/PNG (opÈ›ional):</label>
      <div class="file-input-wrapper">
        <input 
          type="file" 
          id="signatureImage"
          (change)="onSignatureImageSelected($event)" 
          accept="image/jpeg,image/jpg,image/png"
          [disabled]="isLoading"
        />
        <label for="signatureImage" class="file-label">
          <span class="icon">ğŸ–¼ï¸</span>
          <span *ngIf="!signatureImageName">Alege imagine semnÄƒturÄƒ</span>
          <span *ngIf="signatureImageName">{{ signatureImageName }}</span>
        </label>
      </div>
      <small class="help-text">Imaginea va apÄƒrea Ã®n stÃ¢nga semnÄƒturii</small>
    </div>

    <!-- 3. Signature Text (NEW) -->
    <div class="form-group" style="
    display: flex;
    flex-direction: column;
">
      <label for="signatureText">Text SemnÄƒturÄƒ (opÈ›ional pentru non-operator):</label>
      <textarea 
        id="signatureText"
        [(ngModel)]="signatureText"
        placeholder="Ex: Sigilat digital de&#10;InstituÈ›ia NoastrÄƒ&#10;Avizare"
        rows="4"
        [disabled]="isLoading || isOperator"
      ></textarea>
      <small class="help-text" *ngIf="isOperator">Textul este generat automat pentru operatori</small>
      <small class="help-text" *ngIf="!isOperator">Textul personalizat + Data È™i ora vor apÄƒrea pe semnÄƒturÄƒ</small>
    </div>

    <!-- 4. Coordinates Section (always visible) -->
    <h3>ğŸ¯ Coordonate Plasare SemnÄƒturÄƒ</h3>
    <p class="help-text">Sistem coordonate: (0,0) = colÈ› stÃ¢nga-jos al paginii</p>
    
    <div class="form-row">
      <div class="form-group half">
        <label for="signatureX">X (de la stÃ¢nga):</label>
        <input 
          type="number" 
          id="signatureX"
          [(ngModel)]="signatureX"
          [disabled]="isLoading"
        />
      </div>
      
      <div class="form-group half">
        <label for="signatureY">Y (de jos Ã®n sus):</label>
        <input 
          type="number" 
          id="signatureY"
          [(ngModel)]="signatureY"
          [disabled]="isLoading"
        />
      </div>
    </div>

    <div class="form-row">
      <div class="form-group half">
        <label for="signatureWidth">LÄƒÈ›ime:</label>
        <input 
          type="number" 
          id="signatureWidth"
          [(ngModel)]="signatureWidth"
          [disabled]="isLoading"
        />
      </div>
      
      <div class="form-group half">
        <label for="signatureHeight">ÃnÄƒlÈ›ime:</label>
        <input 
          type="number" 
          id="signatureHeight"
          [(ngModel)]="signatureHeight"
          [disabled]="isLoading"
        />
      </div>
    </div>

    <div class="form-group">
      <label for="signaturePage">PaginÄƒ:</label>
      <input 
        type="number" 
        id="signaturePage"
        [(ngModel)]="signaturePage"
        min="1"
        [disabled]="isLoading"
      />
    </div>

    <!-- 5. Operator Checkbox (NEW) -->
    <div class="form-group">
      <label class="checkbox-label">
        <input 
          type="checkbox"
          id="isOperator"
          name="isOperator"
          [(ngModel)]="isOperator"
          [disabled]="isLoading"
        />
        Este Operator? (semnÄƒturÄƒ automatÄƒ cu date token)
      </label>
    </div>

    <button 
      class="btn-primary" 
      (click)="signDocument()" 
      [disabled]="!selectedFile || isLoading || serviceStatus === 'offline'"
    >
      <span *ngIf="!isLoading">ğŸ–Šï¸ SemneazÄƒ Document</span>
      <span *ngIf="isLoading" class="loading">
        <span class="spinner"></span> Se semneazÄƒ...
      </span>
    </button>
  </div>

  <!-- Mesaje -->
  <div class="messages">
    <div *ngIf="errorMessage" class="alert alert-error">
      {{ errorMessage }}
      <button 
        *ngIf="serviceStatus === 'offline'" 
        class="btn-link"
        (click)="showInstructions = true"
      >
        Vezi instrucÈ›iuni
      </button>
    </div>
    <div *ngIf="successMessage" class="alert alert-success">
      {{ successMessage }}
    </div>
  </div>

    <!-- Rezultat -->
    <div *ngIf="signedPdfUrl" class="result-section card">
      <h2>âœ… Document Semnat</h2>
      
      <div class="actions">
        <button class="btn-success" (click)="downloadSignedPdf()">
          ğŸ“¥ DescarcÄƒ PDF Semnat
        </button>
        <button class="btn-secondary" (click)="reset()">
          â¬…ï¸ SemneazÄƒ Alt Document
        </button>
      </div>
  
      <div class="pdf-preview">
        <h3>Preview Document Semnat:</h3>
        <iframe 
          [src]="signedPdfUrl" 
          width="100%" 
          height="600px"
          frameborder="0"
        ></iframe>
      </div>
    </div>
</div>