<div class="pdf-signer-container">
  <div class="header">
    <h1>ğŸ” Semnare ElectronicÄƒ PDF</h1>
    <div class="service-status" [ngClass]="serviceStatus">
      <span class="status-indicator"></span>
      <span *ngIf="serviceStatus === 'online'">Serviciu online</span>
      <span *ngIf="serviceStatus === 'offline'">Serviciu offline</span>
      <span *ngIf="serviceStatus === 'unknown'">Verificare...</span>
      <button 
        class="btn-recheck" 
        (click)="recheckStatus()"
        [disabled]="serviceStatus === 'unknown'"
        title="VerificÄƒ din nou statusul"
        type="button"
      >
        <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
          <path d="M11.534 7h3.932a.25.25 0 0 1 .192.41l-1.966 2.36a.25.25 0 0 1-.384 0l-1.966-2.36a.25.25 0 0 1 .192-.41zm-11 2h3.932a.25.25 0 0 0 .192-.41L2.692 6.23a.25.25 0 0 0-.384 0L.342 8.59A.25.25 0 0 0 .534 9z"/>
          <path fill-rule="evenodd" d="M8 3c-1.552 0-2.94.707-3.857 1.818a.5.5 0 1 1-.771-.636A6.002 6.002 0 0 1 13.917 7H12.9A5.002 5.002 0 0 0 8 3zM3.1 9a5.002 5.002 0 0 0 8.757 2.182.5.5 0 1 1 .771.636A6.002 6.002 0 0 1 2.083 9H3.1z"/>
        </svg>
      </button>
    </div>
  </div>

  <!-- InstrucÈ›iuni repornire serviciu -->
  <div *ngIf="serviceStatus === 'offline' || showInstructions" class="instructions-panel card">
    <div class="instructions-header">
      <h3>âš ï¸ Serviciul de Semnare Nu Este Disponibil</h3>
      <button class="btn-close" (click)="showInstructions = false">âœ•</button>
    </div>
    
    <div class="instructions-content">
      <p><strong>Pentru a porni serviciul de semnare:</strong></p>
      
      <ol>
        <li>
          <strong>VerificÄƒ dacÄƒ ruleazÄƒ:</strong>
          <ul>
            <li>Deschide <strong>Task Manager</strong> (Ctrl + Shift + Esc)</li>
            <li>CautÄƒ procesul <code>SignToolDaemon.exe</code></li>
          </ul>
        </li>
        
        <li>
          <strong>DacÄƒ nu ruleazÄƒ, porneÈ™te-l:</strong>
          <ul>
            <li>NavigheazÄƒ la: <code>C:\Program Files\SignTool\</code></li>
            <li>RuleazÄƒ: <code>SignToolDaemon.exe</code></li>
          </ul>
        </li>
        
        <li>
          <strong>SAU foloseÈ™te Command Prompt:</strong>
          <div class="code-block">
            <code>cd C:\zzz\Ionut\SignToolDaemon\SignToolDaemon</code><br>
            <code>dotnet run</code>
          </div>
        </li>
        
        <li>
          <strong>VerificÄƒ cÄƒ serviciul ascultÄƒ pe portul corect:</strong>
          <div class="code-block">
            <code>netstat -ano | findstr :5000</code>
          </div>
        </li>
      </ol>

      <div class="help-note">
        <strong>ğŸ’¡ NotÄƒ:</strong> Serviciul trebuie sÄƒ ruleze <strong>local pe calculatorul tÄƒu</strong> 
        pentru a avea acces la token-ul USB de semnare.
      </div>

      <button class="btn-primary" (click)="recheckStatus()">
        ğŸ”„ VerificÄƒ Din Nou
      </button>
    </div>
  </div>

  <div class="upload-section card">
    <h2>ğŸ“„ SelecteazÄƒ Document PDF</h2>
    
    <div class="file-input-wrapper">
      <input 
        type="file" 
        id="pdfFile"
        (change)="onFileSelected($event)" 
        accept=".pdf"
        [disabled]="isLoading"
      />
      <label for="pdfFile" class="file-label">
        <span class="icon">ğŸ“</span>
        <span *ngIf="!fileName">Alege fiÈ™ier PDF</span>
        <span *ngIf="fileName">{{ fileName }}</span>
      </label>
    </div>

    <div class="form-group">
      <label for="fieldName">Nume cÃ¢mp semnÄƒturÄƒ (opÈ›ional):</label>
      <input 
        type="text" 
        id="fieldName"
        [(ngModel)]="fieldName"
        placeholder="signature1"
        [disabled]="isLoading || useCoordinates"
      />
    </div>

    <div class="form-group">
      <label>
        <input 
          type="checkbox" 
          [(ngModel)]="useCoordinates"
          [disabled]="isLoading"
        />
        FoloseÈ™te coordonate X, Y Ã®n loc de cÃ¢mp formular
      </label>
    </div>

    <div *ngIf="useCoordinates" class="coordinates-section">
      <h3>ğŸ¯ Coordonate Plasare SemnÄƒturÄƒ</h3>
      <p class="help-text">Sistem coordonate: (0,0) = colÈ› stÃ¢nga-jos al paginii</p>
      
      <div class="form-row">
        <div class="form-group half">
          <label for="signatureX">X (de la stÃ¢nga):</label>
          <input 
            type="number" 
            id="signatureX"
            [(ngModel)]="signatureX"
            [disabled]="isLoading"
          />
        </div>
        
        <div class="form-group half">
          <label for="signatureY">Y (de jos Ã®n sus):</label>
          <input 
            type="number" 
            id="signatureY"
            [(ngModel)]="signatureY"
            [disabled]="isLoading"
          />
        </div>
      </div>

      <div class="form-row">
        <div class="form-group half">
          <label for="signatureWidth">LÄƒÈ›ime:</label>
          <input 
            type="number" 
            id="signatureWidth"
            [(ngModel)]="signatureWidth"
            [disabled]="isLoading"
          />
        </div>
        
        <div class="form-group half">
          <label for="signatureHeight">ÃnÄƒlÈ›ime:</label>
          <input 
            type="number" 
            id="signatureHeight"
            [(ngModel)]="signatureHeight"
            [disabled]="isLoading"
          />
        </div>
      </div>

      <div class="form-group">
        <label for="signaturePage">PaginÄƒ:</label>
        <input 
          type="number" 
          id="signaturePage"
          [(ngModel)]="signaturePage"
          min="1"
          [disabled]="isLoading"
        />
      </div>
    </div>

    <div class="form-group">
      <label for="tokenPin">PIN Token (pentru test):</label>
      <input 
        type="password" 
        id="tokenPin"
        [(ngModel)]="tokenPin"
        placeholder="Introdu PIN-ul"
        [disabled]="isLoading"
      />
    </div>

    <h3>ğŸ“‹ Date Ãnregistrare Document</h3>
    
    <div class="form-row">
      <div class="form-group half">
        <label for="nrLucrare">Nr. Lucrare:</label>
        <input 
          type="text" 
          id="nrLucrare"
          [(ngModel)]="nrLucrare"
          placeholder="Ex: 145/256052"
          [disabled]="isLoading"
        />
      </div>
      
      <div class="form-group half">
        <label for="dataLucrare">Data Lucrare:</label>
        <input 
          type="date" 
          id="dataLucrare"
          [(ngModel)]="dataLucrare"
          [disabled]="isLoading"
        />
      </div>
    </div>

    <div class="form-row">
      <div class="form-group half">
        <label for="nrAct">Nr. Act (RI1):</label>
        <input 
          type="text" 
          id="nrAct"
          [(ngModel)]="nrAct"
          placeholder="Ex: 1234"
          [disabled]="isLoading"
        />
      </div>
      
      <div class="form-group half">
        <label for="dataAct">Data Act:</label>
        <input 
          type="date" 
          id="dataAct"
          [(ngModel)]="dataAct"
          [disabled]="isLoading"
        />
      </div>
    </div>

    <button 
      class="btn-primary" 
      (click)="signDocument()" 
      [disabled]="!selectedFile || isLoading || serviceStatus === 'offline'"
    >
      <span *ngIf="!isLoading">ğŸ–Šï¸ SemneazÄƒ Document</span>
      <span *ngIf="isLoading" class="loading">
        <span class="spinner"></span> Se semneazÄƒ...
      </span>
    </button>
  </div>

  <!-- Mesaje -->
  <div class="messages">
    <div *ngIf="errorMessage" class="alert alert-error">
      {{ errorMessage }}
      <button 
        *ngIf="serviceStatus === 'offline'" 
        class="btn-link"
        (click)="showInstructions = true"
      >
        Vezi instrucÈ›iuni
      </button>
    </div>
    <div *ngIf="successMessage" class="alert alert-success">
      {{ successMessage }}
    </div>
  </div>

    <!-- Rezultat -->
    <div *ngIf="signedPdfUrl" class="result-section card">
      <h2>âœ… Document Semnat</h2>
      
      <div class="actions">
        <button class="btn-success" (click)="downloadSignedPdf()">
          ğŸ“¥ DescarcÄƒ PDF Semnat
        </button>
        <button class="btn-secondary" (click)="reset()">
          â¬…ï¸ SemneazÄƒ Alt Document
        </button>
      </div>
  
      <div class="pdf-preview">
        <h3>Preview Document Semnat:</h3>
        <iframe 
          [src]="signedPdfUrl" 
          width="100%" 
          height="600px"
          frameborder="0"
        ></iframe>
      </div>
    </div>
</div>